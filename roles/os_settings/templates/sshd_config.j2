# Managed by Ansible â€” do not edit manually
# Minimal, modern, and compatible across Ubuntu & RHEL families.

Port {{ ssh_port | default('22') }}
AddressFamily any
# Listen on v4; add v6 too if you want
ListenAddress 0.0.0.0
#ListenAddress ::

# Authentication
PermitRootLogin yes
PubkeyAuthentication yes
PasswordAuthentication yes
KbdInteractiveAuthentication no
ChallengeResponseAuthentication no
PermitEmptyPasswords no
#AuthenticationMethods publickey
AuthorizedKeysFile .ssh/authorized_keys

{% if ansible_os_family == 'Debian' %}
# Ubuntu prints MOTD via PAM already
PrintMotd no
{% endif %}
UsePAM yes

# Access control
# AllowGroups {{ ssh_allow_groups | default('sshusers') }}
# AllowUsers {{ ssh_allow_users | default('') }}

MaxAuthTries 5
LoginGraceTime 30s
MaxSessions 10
MaxStartups 10:30:100

# Network / keepalive
UseDNS no
TCPKeepAlive yes
ClientAliveInterval 300
ClientAliveCountMax 2

# Forwarding / tunneling (tighten as desired)
X11Forwarding no
AllowAgentForwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no

# Subsystem
Subsystem sftp internal-sftp
# ChrootDirectory /sftp/%u

# Logging
SyslogFacility AUTHPRIV
LogLevel VERBOSE

# KEX / ciphers / MACs (conservative, widely supported)
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com

# Filesystem / privilege hardening
StrictModes yes
PermitUserEnvironment no
IgnoreRhosts yes
HostbasedAuthentication no
PrintLastLog yes
Compression no
{% if ssh_enable_pubkeyauthoptions | default(false) %}
PubkeyAuthOptions verify-required
{% endif %}
